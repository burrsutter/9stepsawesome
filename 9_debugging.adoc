= Step 9: Debugging
Burr Sutter <burrsuter@gmail.com>

== Java

https://blog.christianposta.com/kubernetes/java-remote-debug-for-applications-running-in-kubernetes/


https://hub.docker.com/r/fabric8/java-jboss-openjdk8-jdk/

https://www.eclipse.org/jkube/docs/kubernetes-maven-plugin#jkube:debug

https://code.visualstudio.com/docs/java/java-kubernetes

https://code.visualstudio.com/blogs/2017/09/28/java-debug

For springboot

Create a directory `hello/springboot/src/main/jkube`

Create a file called service.yml

----
apiVersion: v1
kind: Service
spec:
  type: NodePort
----

and Create a file called deployment.yml

----
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  namespace: myspace
----

Setup [Eclipse JKube](https://www.eclipse.org/jkube) in your `pom.xml` by adding this to `<plugins>` section:
- For Kubernetes:

[source]
----
<plugin>
  <groupId>org.eclipse.jkube</groupId>
  <artifactId>kubernetes-maven-plugin</artifactId>
  <version>${jkube.version}</version>
  <executions>
    <execution>
      <id>jkube</id>
      <goals>
        <goal>resource</goal>
        <goal>helm</goal>
        <goal>build</goal>
      </goals>
    </execution>
  </executions>
</plugin>
----
Run `k8s:debug` goal to debug your application running in Kubernetes:

[source]
----
mvn k8s:debug

...
[INFO] --- kubernetes-maven-plugin:1.0.1:debug (default-cli) @ boot-demo ---
[INFO] k8s: Using Kubernetes at https://192.168.39.71:8443/ in namespace default with manifest /home/rohaan/work/repos/9stepsawesome/hello/springbootjkube/target/classes/META-INF/jkube/kubernetes.yml
[INFO] k8s: Using namespace: default
[INFO] k8s: Updating Service from kubernetes.yml
[INFO] k8s: Updated Service: target/jkube/applyJson/default/service-boot-demo-2.json
[INFO] k8s: Enabling debug on Deployment boot-demo
[INFO] k8s: Waiting for debug pod with selector LabelSelector(matchExpressions=[], matchLabels={app=boot-demo, provider=jkube, group=com.burrsutter}, additionalProperties={}) and environment variables {JAVA_DEBUG_SUSPEND=false, JAVA_ENABLE_DEBUG=true}
[INFO] k8s: Port forwarding to port 5005 on pod boot-demo-5546889b66-l74zz using command /home/rohaan/.local/bin/kubectl
----

- For OpenShift:

[source]
----
<plugin>
  <groupId>org.eclipse.jkube</groupId>
  <artifactId>openshift-maven-plugin</artifactId>
  <version>${jkube.version}</version>
  <executions>
    <execution>
      <id>jkube</id>
      <goals>
        <goal>resource</goal>
        <goal>build</goal>
      </goals>
    </execution>
  </executions>
</plugin>

----

[source]
----
mvn oc:debug

...
[INFO] --- openshift-maven-plugin:1.0.1:debug (default-cli) @ boot-demo ---
[INFO] oc: Using OpenShift at https://api.rh-idev.openshift.com:443/ in namespace rokumar with manifest /home/rohaan/work/repos/9stepsawesome/hello/springbootjkube/target/classes/META-INF/jkube/openshift.yml
[INFO] oc: OpenShift platform detected
[INFO] oc: Using project: rokumar
[INFO] oc: Updating Service from openshift.yml
[INFO] oc: Updated Service: target/jkube/applyJson/rokumar/service-boot-demo-1.json
[INFO] oc: Enabling debug on DeploymentConfig boot-demo
[INFO] oc: Updating Route from openshift.yml
[INFO] oc: Updated Route: target/jkube/applyJson/rokumar/route-boot-demo-1.json
[INFO] oc: Waiting for debug pod with selector LabelSelector(matchExpressions=[], matchLabels={app=boot-demo, provider=jkube, group=com.burrsutter}, additionalProperties={}) and environment variables {JAVA_DEBUG_SUSPEND=false, JAVA_ENABLE_DEBUG=true}
[INFO] oc:  [W] boot-demo-4-fbdcw status: Running Ready
[INFO] oc:  [W] boot-demo-5-mxm5q status: Pending
[INFO] oc:  [W] boot-demo-5-mxm5q status: Pending
[INFO] oc:  [W] boot-demo-5-mxm5q status: Pending
[INFO] oc:  [W] boot-demo-5-mxm5q status: Running Ready
[INFO] oc: Port forwarding to port 5005 on pod boot-demo-5-mxm5q using command /home/rohaan/.local/bin/oc

----

Visual Studio Code

Debug - Add Configuration

which creates a Launch.json file, then comment it like so
----
{
    // Use IntelliSense to learn about possible attributes.
    // Hover to view descriptions of existing attributes.
    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
    "version": "0.2.0",
    "configurations": [
        // {
        //     "type": "java",
        //     "name": "Debug (Launch)",
        //     "request": "launch",
        //     "cwd": "${workspaceFolder}",
        //     "console": "internalConsole",
        //     "stopOnEntry": false,
        //     "mainClass": "",
        //     "args": ""
        // },
        // {
        //     "type": "java",
        //     "name": "Debug (Launch)-HellobootApplication<boot-demo>",
        //     "request": "launch",
        //     "cwd": "${workspaceFolder}",
        //     "console": "internalConsole",
        //     "stopOnEntry": false,
        //     "mainClass": "com.burrsutter.HellobootApplication",
        //     "args": "",
        //     "projectName": "boot-demo"
        // },
        {
            "type": "java",
            "name": "Debug (Attach)",
            "request": "attach",
            "hostName": "localhost",
            "port": "5005"
        }
    ]
}
----

with port 5005



== Node.js
https://developers.redhat.com/blog/2018/05/15/debug-your-node-js-application-on-openshift-with-chrome-devtools/

